---
title: "Gatsby cz. 7 - blog MDX cz. 1"
section: "blog"
subsection: "it"
set: gatsby
date: 2021-08-02
edited: 2022-01-13
image: ../blogimages/Gatsby_Monogram.png
tags: react, gatsby
description: "Markdown a MDX, programistyczne tworzenie stron z gatsby-node.js i File System Route API, automatycznie generowane tagi"
---

StaÅ‚y adres serii wpisÃ³w o Gatsbym - [/blog/gatsby](/blog/gatsby)

### WstÄ™p

Tworzymy bloga. W tym wpisie przedstawiÄ™ jak utworzyÄ‡ blog MDX z listÄ… wpisÃ³w i tagami.

<Warning comment="Uwaga: niniejszy opis dotyczy wersji 4.x Gatsby. W aktualnej naprawdÄ™ wiele siÄ™ zmieniÅ‚o. Jak tylko bÄ™dÄ™ miaÅ‚ czas to uaktualniÄ™" />

I tutaj od razu pierwsze zastrzeÅ¼enie - piszÄ™ zarÃ³wno w tytule jak i w treÅ›ci o blogu, ale uÅ¼ywajÄ…c tego mechanizmu tak samo moÅ¼na zbudowaÄ‡ normalnÄ… stronÄ™. Na przykÅ‚ad caÅ‚a moja strona, z doÅ›Ä‡ skomplikowanÄ… hierarchiÄ… i wieloma rodzajami treÅ›ci jest jednym systemem / instalacjÄ… Gatsby'ego, w ktÃ³rej uÅ¼yÅ‚em MDX i Gatsby Node API.

### Start

Plan przedstawia siÄ™ nastÄ™pujÄ…co:

- Gatsby sam tworzy strony, jak?
- instalacja i konfiguracja MDX
- pliki wpisÃ³w w formacie .mdx
- dwa sposoby budowania strony:
  - Gatsby Node APIs (gatsby-node.js)
  - File System Route API
- tagi, klikalne z automatycznie generowanÄ… listÄ… wpisÃ³w z tym tagiem

Zatem zobaczmy co dla nas potrafi zrobiÄ‡ maszyna!

### Strony generowane programistycznie

W przypadku takiego bloga mamy do czynienia z programistycznie generowanymi stronami. Å»eby to zadziaÅ‚aÅ‚o trzeba zÅ‚oÅ¼yÄ‡ razem kilka mechanizmÃ³w:

- najpierw potrzebujemy jakiegoÅ› systemu, ktÃ³ry wyrysuje Å›cieÅ¼ki albo inaczej mÃ³wiÄ…c utworzy lokalizacje, ktÃ³Â©e fizycznie nie istniejÄ…, w przypadku Gatsby'ego zostanÄ… one utworzone w podczas dziaÅ‚ania serweru deweloperskiego albo w buildzie na podstawie danych tego systemu - tutaj mamy dwie moÅ¼liwoÅ›ci i o nich za chwilÄ™
- wyglÄ…d zapewniajÄ… pliki layoutu (w przypadku gatsby-node.js takÅ¼e szablony)
- caÅ‚kiem osobno, poza katalogiem /src/pages sÄ… pliki treÅ›ci, zarÃ³wno tekst jak i ilustracje (lub inne media), tekst jest w formacie Markdown: albo .md albo .mdx
- do pobrania plikÃ³w treÅ›ci zostanie uÅ¼yty GraphQL, tutaj majÄ…c do dyspozycji dane frontmattera pokazuje peÅ‚niÄ™ moÅ¼liwoÅ›ci

Do tworzenia Å›cieÅ¼ek moÅ¼emy uÅ¼yÄ‡ dwÃ³ch metod udostÄ™pnianych w Gatsbym:

- **Gatsby Node APIs** (gatsby-node.js) uÅ¼ywany od lat standard dajÄ…cy wiele moÅ¼liwoÅ›ci.
- **File System Route API**, wprowadzonego jesieniÄ… 2020; w tej chwili nie ma on moÅ¼liwoÅ›ci filtrowania i nadaje siÄ™ do stron, w ktÃ³rym jest tylko jedno ÅºrÃ³dÅ‚o danych MDX.

### Markdown i MDX

Markdown jest formatem tekstowym, ktÃ³ry jest zarÃ³wno Å‚atwy w edycji jak i przetwarzaniu maszynowym, wiÄ™cej o nim w artykule [Markdown](/it/js/markdown).

JeÅ›li chodzi o wyÅ›wietlenie Markdowna mamy dwie moÅ¼liwoÅ›ci:

- czysty Markdown, do jego wyÅ›wietlenia uÅ¼ywamy Remarka (rozszerzenie .md) - [remark - markdown processor powered by plugins](https://remark.js.org/).
- MDX (rozszerzenie .mdx): procesor Markdowna dodatkowo umoÅ¼liwiajÄ…cy umieszczenie w pliku .mdx dowolnego komponentu. Jest to poÅ‚Ä…czenie moÅ¼liwoÅ›ci JSX i prostoty Markdowna - [MDX](https://mdxjs.com/).

Tutaj ze wzglÄ™du na wiÄ™ksze moÅ¼liwoÅ›ci zobaczymy jak zastosowaÄ‡ MDX.

### Instalacja MDX

Pakiet npm **MDX**.

```
$ npm i gatsby-plugin-mdx @mdx-js/mdx @mdx-js/react gatsby-source-filesystem
```

Plugin **gatsby-plugin-catch-links**, w przypadku Markdowna niezbÄ™dny. Pozwala on na uÅ¼ywanie odnoÅ›nikÃ³w lokalnych w plikach Markdown, bez tego tracilibyÅ›my atut komponentu Link. DziaÅ‚a bez konfiguracji, wystarczy dodaÄ‡ go do gatsby-config.js.

```
$ npm i gatsby-plugin-catch-links
```

WyÅ›wietlanie obrazkÃ³w w MDX:

```
npm i gatsby-remark-images gatsby-plugin-sharp
```

Plugin **gatsby-remark-vscode** (do wyÅ›wietlenia kodu).

```bash
$ npm i gatsby-transformer-remark gatsby-remark-vscode
```

KonfiguracjÄ™ tego pluginu przedstawiÅ‚em we wpisie ["Gatsby cz. 5 - pluginy"](/blog/gatsby-pluginy#prezentowanie-kodu-gatsby-remark-vscode).

#### OdnoÅ›niki

- [MDX](https://mdxjs.com/)
- Gatsby [Docs / Reference Guides / MDX](https://www.gatsbyjs.org/docs/mdx/) | [gatsby-plugin-mdx](https://www.gatsbyjs.com/plugins/gatsby-plugin-mdx/)
- LekoArts Blog ["Language tabs for Gatsby's code blocks"](https://www.lekoarts.de/en/blog/language-tabs-for-gatsbys-code-blocks) | ["Adding line numbers and code highlighting to MDX code blocks"](https://www.lekoarts.de/en/blog/adding-line-numbers-and-code-highlighting-to-mdx-code-blocks)
- Malik Gabroun ["Syntax Highlighting in Gatsby MDX"](https://malikgabroun.com/blog/syntax-highlighting-in-gatsby-mdx)
- Sam Julien ["Up and Running with Gatsby: Markdown & MDX"](https://thinkster.io/tutorials/up-and-running-with-gatsby-markdown/)
- Daniel Stout ["Intro to MDX in Gatsby"](https://www.digitalocean.com/community/tutorials/gatsbyjs-mdx-in-gatsby)
- Brad Westfall ["Blogging with Gatsby & MDX"](https://reacttraining.com/blog/gatsby-mdx-blog/)
- Johno ["Create a table of contents component for MDX in Gatsby"](https://johno.com/mdx-table-of-contents-components-in-gatsby/)
- Scott Spence ["Convert the Gatsby default starter blog to use MDX" YT [19:26]](https://www.youtube.com/watch?v=gck4RjaX5D4)
- David Dal Busco ["Stylish Cards and Syntax Highlighting With Gatsby"](https://medium.com/better-programming/stylish-cards-and-syntax-highlighting-with-gatsby-e2806b9cb987) | Sebastien Lorber ["Using React hooks in MDX"](https://dev.to/sebastienlorber/using-react-hooks-in-mdx-4ei6)
- Julianâ€‹Garamendyâ€‹.dev ["Adding custom OpenGraph images to Gatsby Starter Blog"](https://juliangaramendy.dev/custom-open-graph-images-in-gatsby-blog/)

Remark

- [remark - markdown processor powered by plugins](https://remark.js.org)
- [gatsby-remark-vscode](https://www.gatsbyjs.com/plugins/gatsby-remark-vscode/)

PrismJS

- [Niklas "Implement PrismJS in GatsbyJS"](https://dev.to/niklasmtj/implement-prismjs-in-gatsbyjs-fff)
- ["styling markdown code snippets with prismjs"](https://stephenweiss.dev/blog/2020-01-15/syntax-highlighting-prismjs-gatsby/)
- using-remark [Daisy Buchanan"Code and Syntax Highlighting with PrismJS"](https://using-remark.gatsbyjs.org/code-and-syntax-highlighting/)
- [gatsby-plugin-mdx with prismjs and MDXRenderer, how? #17361](https://github.com/gatsbyjs/gatsby/issues/17361)

Inne

- DeckDeckGo [Highlight Code](https://docs.deckdeckgo.com/?path=/story/components-highlight-code--highlight-code/)
- [Docusaurus](https://docusaurus.io/)

### Plik MDX

Na samym poczÄ…tku pliku .mdx jest frontmatter. Nazwa ta wywodzi siÄ™ jeszcze z czasÃ³w zecerstwa. Jest to seria zdefiniowanych pÃ³l zawierajÄ…cych podstawowe dane o pliku, ktÃ³re dalej bÄ™dziemy przetwarzaÄ‡. To bardzo elastyczny mechanizm. Nazwy i liczba tych pÃ³l jest dowolna. Tworzymy tylko takie, ktÃ³re sÄ… potrzebne. NajczÄ™Å›ciej jest to tytuÅ‚, sekcja (ewentualnie podsekcja), data wpisu, czasem teÅ¼ ostatniej edycji, czasem autor, Å›cieÅ¼ka do powiÄ…zanego z wpisem obrazka i tagi. MoÅ¼na teÅ¼ tam umieÅ›ciÄ‡ dÅ‚uÅ¼sze fragmenty tekstu jak np. streszczenie wpisu dodawane w liÅ›cie wpisÃ³w. Dopuszczalne typy danych to: string, numer, bolean i data.

Frontmatter i reszta pliku .mdx moÅ¼e wyglÄ…daÄ‡ tak:

**/src/blogposts/any-blogpost.mdx**

```md
---
title: "TytuÅ‚ wpisu o Gatsbym"
section: "blog"
subsection: "it"
date: 2021-07-10
edited: 2021-07-13
img: ../blogimages/gatsby.jpg
tags: react, gatsby
description: "Opis treÅ›ci, wymienione najwaÅ¼niejsze elementy, dowolny tekst."
---

### Pierwszy podtytuÅ‚

TreÅ›Ä‡. Pierwszy akapit.

Drugi akapit.

[Alt obrazka](Å›cieÅ¼ka_wzglÄ™dna_do_obrazka)
*Opis obrazka*

- pierwszy element listy nieuporzÄ…dkowanej
- drugi element listy nieuporzÄ…dkowanej
  1. pierwszy element zagnieÅ¼dÅ¼onej listy uporzÄ…dkowanej
  2. drugi element zagnieÅ¼dÅ¼onej listy uporzÄ…dkowanej
- trzeci element listy nieuporzÄ…dkowanej

{/* treÅ›Ä‡ zakomentowana */}

>Pierwszy wiersz cytatu<br />
>Drugi wiersz cytatu

// itd.
```

W cytacie zostaÅ‚ uÅ¼yty normalny tag HTML. Markdown nie ma udokumentowanego przejÅ›cia do nastÄ™pnej linii, a nieoficjalny `\\` nie wszÄ™dzie dziaÅ‚a.

ZaÅ‚Ã³Å¼my, Å¼e pliki .mdx sÄ… w katalogu: /src/content/blogposts (.mdx) i /src/content/blogimages (obrazki).

**Uwaga:** co do zasady wszystkie pliki treÅ›ci (i tekst i media) powinniÅ›my trzymaÄ‡ poza /src/pages/. Zapobiega to rysowaniu nadmiarowych Å›cieÅ¼ek. PowstanÄ… tylko te, ktÃ³re zdefiniujemy w gastby-node.js lub File System Route API.

- TreÅ›Ä‡ bloga chcesz zaprezentowaÄ‡ na stronie wygenerowanej przy pomocy szablonu i pod adresem url/blog/tytul-wpisu, a nie dodatkowo goÅ‚Ä… treÅ›Ä‡ pod adresem dajmy na to url/blogposts/tytul-wpisu (a taka Å›cieÅ¼ka by powstaÅ‚a, gdyby katalog z wpisamy byÅ‚ wewnÄ…trz /src/pages). Do tego w tej bÅ‚Ä™dnej Å›cieÅ¼ce mogÅ‚yby siÄ™ znaleÅºÄ‡ wpisy nieopublikowane.
- Mniej Å›cieÅ¼ek to krÃ³tszy czas kompilacji i Å‚atwiejsze 404.


### GraphQL

W przypadku stron generowanych programistycznie GraphQL jest nie tylko narzÄ™dziem wymiany danych wewnÄ…trz strony, ale podstawÄ… budowania jej hierarchii. O ile da siÄ™ zbudowaÄ‡ stronÄ™ w Gatsbym bez GraphQL, to taki system z MDX jest juÅ¼ niemoÅ¼liwy - tu odsyÅ‚am do wpisu ["Gatsby cz. 4 - GraphQL & obrazki"](/blog/gatsby-graphql) gdzie jest to wyjaÅ›nione.

Warto teÅ¼ obejrzeÄ‡ dwa filmy autorstwa Artura Chmaro:

- ["GatsbyJS - Pobieranie danych z GraphQL (Pokedex ğŸ¦„)" [YT 16:50]](https://www.youtube.com/watch?v=JK18MoOlBOQ) (tutaj uÅ¼yto zewnÄ™trznego API, wiÄ™c byÅ‚ potrzebny plugin gatsby-source-graphql)
- ["GatsbyJS - Generowanie podstron (Pokedex ğŸ¦„)" [YT 15:52]](https://www.youtube.com/watch?v=bpuUPXdEtjo) - wzmiankowana tu strona dokumentacji Gatsby'ego to ["Creating and Modifying Pages"](https://www.gatsbyjs.com/docs/creating-and-modifying-pages/)

Katalogi z treÅ›ciÄ… bloga trzeba udostÄ™pniÄ‡ GraphQL.

**/gatsby-config.js**

```js
        `gatsby-plugin-mdx`,
        {
   resolve: `gatsby-source-filesystem`,
   options: {
       name: `blogpost`,
       path: `${__dirname}/src/content/blogposts`,
   },
        },
        {
   resolve: `gatsby-source-filesystem`,
   options: {
       name: `blogimage`,
       path: `${__dirname}/src/content/blogimages`,
   },
        },
```

### Gatsby Node APIs (gatsby-node.js)

Jest to starszy mechanizm, bardziej rozbudowany i majÄ…cy wiÄ™ksze moÅ¼liwoÅ›ci.

#### Plik gatsby-node.js

GÅ‚Ã³wnym narzÄ™dziem budowania strony jest tu plik koniguracyjny gatsby-node.js.

- Requestem (zapytaniem) GraphQL pobieramy wpisy (linie 9-23), tutaj to konkretne zapytanie zostaÅ‚o przypisane do zmiennej, dziÄ™ki temu moÅ¼na zrobiÄ‡ ich caÅ‚Ä… seriÄ™, dla kÅ¼dego rodzaju treÅ›ci osobne.
- Rezultat (wszystkie wÄ™zÅ‚y powyÅ¼szej zmiennej wewnÄ…trz zapytania) przypisujemy do zmiennej, nie jest to konieczne, ale upraszcza kod jeÅ¼eli mamy wiÄ™cej takich zmiennych. Jest to tablica. (linia 28)
- Metod tablicowÄ… [Array.prototype.forEach()](https://developer.mozilla.org/pl/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach) dla kaÅ¼dego wÄ™zÅ‚a funkcjÄ… wbudowanÄ… createPage tworzymy poszczegÃ³lne strony. Tworzona jest Å›cieÅ¼ka, pobiera siÄ™ szablon i przekazuje dane z pliku .mdx do context-u. (linie 29-40)

**/src/gatsby-node.js**

```js {numberLines: true}
const path = require(`path`);

exports.createPages = ({ graphql, actions }) => {

    const { createPage } = actions
    const postTemplate = path.resolve("./src/templates/blogPostTemplate.js");
    
    return graphql(`	{
    posts: allMdx(
      filter: { fileAbsolutePath: { glob: "**/src/content/blogposts/*.mdx" } }
      ) {
        nodes {
   frontmatter {
       title
       section
       subsection
       }
   slug
   id
   body
   }
        }
    }
  `).then((result) => {
        if (result.errors) {
   throw result.errors;
        }
        const posts = result.data.posts.nodes;
        posts.forEach(post => {
   createPage({
       path: "/blog/" + post.slug,
       component: postTemplate,
       ...post,
       context: {
       ...post.context,
       slug: post.slug,
       },
   });
        });
    });
};
```

- Gatsby [Gatsby Node APIs](https://www.gatsbyjs.com/docs/reference/config-files/gatsby-node/) | [Creating Pages from Data Programmatically](https://www.gatsbyjs.com/docs/programmatically-create-pages-from-data/)

#### Szablon wpisu

Szablony znajdujÄ… siÄ™ w katalogu /src/templates. Szablon wpisu:

- odbiera dane wygenerowane przez gatsby-node.js przez request graphql z koÅ„ca pliku (linie 21-44)
- i jako obiekt data propsem przekazuje do swojego wnÄ™trza (linia 6)
- do szablonu importowany jest layout z katalogu /src/components (linia 4) - szablon jest komponentem owijajÄ…cym treÅ›Ä‡, umieszczonym w pliku layoutu.
- import komponentu React'a MDXRenderer (linia 3), ten komponent w linii 14 odbiera treÅ›Ä‡ (body) pliku .mdx i wyÅ›wietla jÄ….

Inaczej moÅ¼na to opisaÄ‡ tak:

- ZewnÄ™trznÄ… warstwÄ… jest layout, w nim osadzony jest komponent szablonu, a w nim z kolei komponent MDXRenderer, ktÃ³ry wyÅ›wietl treÅ›Ä‡ pobranÄ… przez GraphQL z pliku .mdx.
- Dane z frontmattera i slug peÅ‚niÄ… funkcje pomocnicze: slug zapewnia Å›cieÅ¼kÄ™, frontmatter dane sterujÄ…ce, rÃ³Å¼ne parametry (np. tagi czy obraz nagÅ‚Ã³wka) i dane wyÅ›wietlane poza komponentem MDXRenderer takie jak tytuÅ‚ czy data publikacji.
- Åšrodowisko danych zapewniajÄ…cych dziaÅ‚anie tego mechanizmu zostaÅ‚o przygotowane w pliku gatsby-node.js.

**/src/templates/blogPostTemplate.js**

```js {numberLines: true}
import React from "react";
import { Link, graphql } from "gatsby";
import { MDXRenderer } from "gatsby-plugin-mdx";
import LayoutBlog from "../components/layout"

const blogPage = ({ data }) => {

    const { frontmatter, id, body, slug } = data.mdx;

    return (
        <LayoutBlog>
   <Link to="/blog">blog main page</Link>
   <h2>{frontmatter.title}</h2>
   <MDXRenderer>{body}</MDXRenderer>
        </LayoutBlog>
    );
};

export default blogPage

export const query = graphql`
  query BlogPageBySlug($slug: String!) {
   mdx( slug: { eq: $slug } ) {
      id
      body
      slug
      frontmatter {
        title
        section
        subsection
      }
    }
  }
`;
```

#### WyÅ›wietlanie obrazkÃ³w w treÅ›ci posta

Potrzebny bÄ™dzie plugin [gatsby-remark-images](https://www.gatsbyjs.com/plugins/gatsby-remark-images/)

```
npm i gatsby-remark-images gatsby-plugin-sharp
```

PrzykÅ‚adowa konfiguracja (w obrÄ™bie MDX):

**gatsby-config.js**

```js
  {
   resolve: `gatsby-plugin-mdx`,
   options: {
       extensions: [`.mdx`, `.md`],
       gatsbyRemarkPlugins: [
       {
       resolve: `gatsby-remark-images`,
          options: {
            withWebp: true,
            maxWidth: 900,
            backgroundColor: false,
            linkImagesToOriginal: true,
            tracedSVG: true,
            lazy: true,
           },
       },
    ],
  },
  },
```

I teraz moÅ¼emy siÄ™ odwoÅ‚aÄ‡ do obrazka uÅ¼ywajÄ…c Å›cieÅ¼ki wzglÄ™dnej. Trzeba tylko pamiÄ™taÄ‡ by dodaÄ‡ jÄ… do `gatsby-source-filesystem`.

#### Strona gÅ‚Ã³wna bloga

DziaÅ‚a w sposÃ³b analogiczny do powyÅ¼szego szablonu. PoniewaÅ¼ nie wyÅ›wietlamy tu treÅ›ci Å¼adnego wpisu rÃ³Å¼nicÄ… jest brak komponentu MDXRenderer.

ZarÃ³wno tutaj jak i w szablonie wpisu moÅ¼na pobraÄ‡ z frontmattera informacjÄ™ o skojarzonej z wpisem ilustracji. Tutaj moÅ¼emy wyÅ›wietliÄ‡ jÄ… jako powiÄ…zany obrazek a w szablonie wpisu umieÅ›ciÄ‡ go w nagÅ‚Ã³wku.

**/src/pages/blog.js**

```js
import * as React from 'react'
import {Link, graphql} from "gatsby";
import Layout from "../components/layout"

const BlogPage = ({data}) => {
    return (
        <Layout>
        <h2>blog here</h2>
   <p>Dowolny tekst.</p>

<ul>
   {data.allMdx.nodes.map(({ id, frontmatter, slug }) => (
       <li  key={id}>
       <Link to={`/blog/${slug}`}>{frontmatter.title}</Link>
       </li>
      ))}
</ul>
        </Layout>
    )
}

export default BlogPage

export const query = graphql`
query AllPosts {
     allMdx(
      filter: { fileAbsolutePath: { glob: "**/src/blogposts/*.mdx" } }
      ) {
        nodes {
   frontmatter {
       title
       section
       subsection
       date(formatString: "YYYY-MM-DD")
       }
   slug
   id
   body
        }
       pageInfo {
           currentPage
        }
    }
}
`;
```

#### Podsumowanie

*Et voilÃ  !* Powinno dziaÅ‚aÄ‡. CaÅ‚y schemat operacji wyglÄ…da nastÄ™pujÄ…co:

- UÅ¼ywamy plikÃ³w .mdx trzymanych w katalogu poza /src/pages; katalog ten musi zostaÄ‡ wskazany przez gatsby-source-filesystem w gÅ‚Ã³wnym pliku konfiguracyjnym /gatsby-config.js.
- DziÄ™ki powyÅ¼szemu w danych GraphQL pojawiajÄ… siÄ™ dane wpisÃ³w.
- W pliku gatsby-node.js pobieramy te dane, tworzymy z nich tablicÄ™, a z niej generujemy Å›cieÅ¼ki.
- Dane te pobierane sÄ… przez szablon wpisu, do ktÃ³rego importowany jest layout - tak powstaje strona wpisu.
- Potrzebna jest takÅ¼e strona gÅ‚Ã³wna bloga z listÄ… wpisÃ³w. W najprostszej wersji bÄ™dzie to jeden z dwÃ³ch plikÃ³w w katalogu /src/pages (drugim jest wymagany 404.js).

PowyÅ¼szy system najczÄ™Å›ciej jest uÅ¼ywany do tworzenia blogÃ³w. Ale rÃ³wnie dobrze moÅ¼e zostaÄ‡ zastosowany do tworzenia innych stron. Jest to przydatne, jeÅ¼eli skÅ‚adajÄ… siÄ™ z duÅ¼ej liczby dokumentÃ³w.

PodstawowÄ… zaletÄ… zastosowania MDX do stron jest Å‚atwoÅ›Ä‡ i prostota edycji treÅ›ci oraz generalna prostota struktury strony.

JeÅ¼eli przenosimy/tworzymy stronÄ™ z treÅ›ciÄ… w plikach .mdx, musimy siÄ™ liczyÄ‡ z pewnymi ograniczeniami narzucanymi przez Markdown, ktÃ³ry ze wzglÄ™du na prostotÄ™ moÅ¼e byÄ‡ przetwarzany na HTML w ograniczonym zakresie. Markdown nie ma takich elementÃ³w jak div, span, lista definicyjna, klasy czy id. W przypadku MDX jest to kompensowane moÅ¼liwoÅ›ciÄ… umieszczania komponentÃ³w.

W przypadku stron z niewielkÄ… liczbÄ… dokumentÃ³w i takich, ktÃ³re stawiajÄ… na efekty, najlepszym rozwiÄ…zaniem pozostaje JSX.

### File System Route API

JesieniÄ… 2020 pojawiÅ‚a siÄ™ jeszcze jedna moÅ¼liwoÅ›Ä‡ programistycznego tworzenia stron File System Route API. Jest on duÅ¼o prostszy i nie wymaga uÅ¼ycia pliku gatsby-node.js. Na razie jednak nie zastÄ…pi gastby-node.js, bo nie ma moÅ¼liwoÅ›ci filtrowania danych, wrzuca na tworzony schemat Å›cieÅ¼ek caÅ‚Ä… treÅ›Ä‡ .mdx, jakÄ… znajdzie.

PoczÄ…tek, wszystko aÅ¼ do pliku gastby-node.js wyglÄ…da identycznie. Tutaj tego pliku nie potrzebujemy.

File System Route API to jest natywny mechanizm Gatsby'ego i nie wymaga Å¼adnej konfiguracji. Wystarczy, Å¼e wewnÄ…trz /src/pages znajdÄ… siÄ™ katalogi o specyficznie sformtowanych nazwach: uÅ¼ywajÄ… nawiasÃ³w klamrowych zawierajÄ…cych parametry tworzonych Å›cieÅ¼ek.

W kwestii tego jak moÅ¼emy uÅ¼yÄ‡ tych nazw katalogÃ³w cytujÄ…c klasyka "jest wiele moÅ¼liwoÅ›ci", podaÅ‚em tu przykÅ‚ad, ktÃ³ry byÅ‚ mi potrzebny. Po inne opcje odsyÅ‚am do dokumentacji, link na koÅ„cu rozdziaÅ‚u.

W przedstawionym w pierwszym wpisie schemacie strony do wygenerowania Å›cieÅ¼ek i podstron wystarczy nastÄ™pujÄ…cy schemat - z frontmattera pobierane sÄ… nazwy sekcji i podsekcji i tworzÄ… z nich hierarchiÄ™: `https://domena/sekcja/podsekcja`.

- /src/pages/index.js
- /src/pages/404.js (oraz ewentualnie inne podstrony funkcyjne typu about, contact; ich treÅ›Ä‡ to zwykÅ‚y JSX)
- /src/pages/\{Mdx.frontmatter__section}/index.js
- /src/pages/\{Mdx.frontmatter__section}/\{Mdx.frontmatter__subsection}/index.js
- /src/pages/\{Mdx.frontmatter__section}/\{Mdx.frontmatter__subsection}/\{mdx.slug}.js

Jak widaÄ‡ do utworzenia dowolnej strony z sekcjami, podsekcjami mogÄ…cej zawieraÄ‡ dowolnÄ… liczbÄ™ dokumentÃ³w wystarczÄ… dwa katalogi i piÄ™Ä‡ plikÃ³w. A caÅ‚Ä… treÅ›Ä‡, ktÃ³ra pojawi siÄ™ na tej stronie trzymamy w jednym katalogu, w dogodnych do edycji, przejrzystych plikach .mdx. I nie ma bazy danych. Aktualizacji pluginÃ³w na stronie, itd.

Do tego, uÅ¼ywajÄ…c sterowanego propsami wyÅ›wietlnia komponentÃ³w, moÅ¼na dowolnie wybieraÄ‡ dla nich wg parametrÃ³w section i subsection oraz location: layout, design i wyÅ›wietlane elementy stron, np. przypisane dla danej kategorii menu. 

Tutaj nie uÅ¼ywamy plikÃ³w szablonÃ³w, caÅ‚y wyglÄ…d i ukÅ‚ad strony zawiera siÄ™ w komponentach layoutu. RÃ³wnieÅ¼ uÅ¼ywamy komponentu MDXRenderer, zarÃ³wno dla podstron z artykuÅ‚ami jak i dla plikÃ³w indeksÃ³w poszszczegÃ³lnych podsekcji.

Jak juÅ¼ jednak zaznaczyÅ‚em ten mechanizm ma istotne ograniczenie - dziaÅ‚a Å›wietnie jeÅ¼eli mamy jedno ÅºrÃ³dÅ‚o danych, przy czym jako ÅºrÃ³dÅ‚o mam na myÅ›li jednolitÄ… hierarchiÄ™ treÅ›ci: pliki mediÃ³w, treÅ›ci stron i treÅ›ci indeksÃ³w mogÄ… (powinny) byÄ‡ w oddzielnych katalogach. JeÅ›li jednak chcesz mieÄ‡ wiÄ™cej niÅ¼ jednÄ… hierarchiÄ™ treÅ›ci File System Route API pobierze wszystko i zacznie tworzyÄ‡ Å›cieÅ¼ki typu `/null/null/treÅ›Ä‡_z_innej_hierarchii`. MoÅ¼na Å‚aczyÄ‡ te dwa rozwiÄ…zania: gatsby-node.js i File System Route API. To nawet dziaÅ‚a, ale ma wszystkie wady obu: mamy i gatsby-node.js i nadmiarowe Å›cieÅ¼ki, a jako bonus nieunikniony chaos w konfiguracji.

Tak siÄ™ skÅ‚ada, Å¼e na mojej stronie w tej chwili sÄ… trzy takie hierarchie: strona, blog wojenny Festung Breslau i od niedawna drugi blog i chcÄ™, Å¼eby tak pozostaÅ‚o. Nie chcÄ™ ani kompletnie jednolitego systemu, ani trzech zupeÅ‚nie oddzielnych stron i tu stary system gatsby-node.js jest optymalny, mogÄ™ mieÄ‡ tyle oddzielonych od siebie stron ile zechcÄ™, kaÅ¼da z oddzielnÄ… konfiguracjÄ… i to w ramach jednego systemu.

#### Plik strony lub wpisu

Co do zasady dziaÅ‚ania plik podstrony jest bardzo podobny. RÃ³Å¼nice sÄ… w detalach:

- zapytaniem GraphQL pobierany jest plik .mdx o nazwie Å›cieÅ¼ki (podczas buildu Gatsby na podstawie jego nazwy te Å›cieÅ¼ki wyrysowaÅ‚), dotatkowo zaÅ‚oÅ¼ony jest filtr ograniczajÄ…cy pobieranie tylko do plikÃ³w treÅ›ci (linie 36-47).
- dane z pliku .mdx jako obiekt data przekazywne sÄ… do komponentu strony (linia 7).
- na stronie sÄ… wyÅ›wietlane bÄ…dÅº jako propsy (linia 27), bÄ…dÅº jako obiekt body umieszczane w komponencie MDXRenderer (linia 28)
- do sterowania wyÅ›wietlaniem elementÃ³w strony moÅ¼na uÅ¼yÄ‡ albo propsÃ³w z forntmattera (linie 16-17), albo obiektu location i regexa (linie 13-14)
- tutaj dodatkowo umiesciÅ‚em breadcrumb, m.in. dlatego Å¼e jako crumbLabel uÅ¼yty jest props frontmattera (linia 25), ale teÅ¼ Å¼ebyÅ›my pamiÄ™tali, Å¼e nie jesteÅ›my ograniczeni w wyborze skÅ‚adnikÃ³w layoutu

**/src/pages/\{Mdx.frontmatter__section}/\{Mdx.frontmatter__subsection}/\{mdx.slug}.js**

```js {numberLines: true}
import * as React from "react"
import { graphql } from "gatsby"
import { Breadcrumb } from 'gatsby-plugin-breadcrumb'
import { MDXRenderer } from 'gatsby-plugin-mdx'
import Layout from "../../../components/layout"

const ArticlePage = ({ data, pageContext, location }) => {

  const {
    breadcrumb: { crumbs },
  } = pageContext

  const regex = new RegExp('(/)(.*?)/')
  const section = location.pathname.match(regex)[2]
  
  const { frontmatter, id, body, slug } = data.mdx;
  const { title, subsection } = frontmatter;

  return (
    <Layout section={section} subsection={frontmatter.subsection}>
      <Breadcrumb
        location={location}
        crumbs={crumbs}
        crumbSeparator=" / "
        crumbLabel={frontmatter.title}
      />
      <h2>{frontmatter.title}</h2>
      <MDXRenderer>{body}</MDXRenderer>
    </Layout>
  )
}

export default ArticlePage

export const query = graphql`
query ArticlePageSubsectionQuery($slug: String!) {
  mdx(slug: { eq: $slug }, fileAbsolutePath: {glob: "**/src/content/pagearticles/*.mdx" }) {
    id
    slug
    body
    frontmatter {
      title
      section
      subsection
    }
  }
}
`;
```
#### Plik indeksu dziaÅ‚u

RÃ³zni siÄ™ od pliku treÅ›ci gÅ‚Ã³wnie zapytaniem GraphQL:

- pobieramy wszystkie pliki .mdx indeksÃ³w, tutaj jako filtr zastosowany jest props frontmattera (linia 35), rÃ³wnie dobrze moÅ¼e to byÄ‡ jak w poprzednim przykÅ‚adzie filtr Å›cieÅ¼ki dostÄ™pu, czyli wybrany katalog
- przekazane do komponentu strony sÄ… filtrowane i wybierny jest ten ktÃ³rego obiekt location jest zgodny z propsem frontmattera i potem tych danych uÅ¼ywamy do wyÅ›wietlenia treÅ›ci pliku indeksu (linie 13-14).

**/src/pages/\{Mdx.frontmatter__section}/\{Mdx.frontmatter__subsection}/index.js**

```js {numberLines: true}
import * as React from "react"
import { graphql } from "gatsby"
import Layout from "../../../components/layout"
import { Breadcrumb } from 'gatsby-plugin-breadcrumb'
import { MDXRenderer } from 'gatsby-plugin-mdx'

const ArticlesPage = ({ data, pageContext, location }) => {
    
    const {
        breadcrumb: { crumbs },
    } = pageContext

    const properMDX = data.allMdx.nodes.filter(item => location.pathname.includes(item.frontmatter.subsection))
    const { frontmatter } = properMDX[0];

    return (
        <Layout section={frontmatter.section} subsection={frontmatter.subsection}>
   
   <Breadcrumb
       location={location}
       crumbs={crumbs}
       crumbSeparator=" / "
       crumbLabel={frontmatter.title}
   />
   <h2>{frontmatter.title}</h2>
   <MDXRenderer>{properMDX[0].body}</MDXRenderer>
        </Layout>
    )
}

export default ArticlesPage

export const query = graphql`
    query IndexTestTrue {
        allMdx(filter: {frontmatter: {comment: {eq: "index"}}}) {
   nodes {
     slug
     frontmatter {
       title
       comment
       subsection
       section
     }
     body
     id
   }
          }
  }
`;
```

- Gatsby [Announcing Gatsbyâ€™s new File System Route API](https://www.gatsbyjs.com/blog/fs-route-api/) | [File System Route API](https://www.gatsbyjs.com/docs/reference/routing/file-system-route-api/)
- [Stu Finn "Gatsby's awesome new File System Route API"](https://dev.to/stu/gatsby-s-awesome-new-file-system-route-api-50k9)
- [Scott Spence "Gatsby File System Route API with MDX"](https://scottspence.com/2020/11/29/gatsby-file-system-route-api/)

### Tagi

**RozdziaÅ‚ o tagach na razie umieszczam tu, ale docelowo znajdzie siÄ™ on w czÄ™Å›ci drugiej wpisu o blogu MDX.**

Potrzebujemy tagÃ³w: Å‚atwych w utrzymaniu, wyÅ›wietlanych z blogiem i linkujÄ…cych do strony z automatycznie generowanÄ… listÄ… wszystkich wpisÃ³w z tym samym tagiem.

Najpierw trzeba utworzyÄ‡ pole tagi we frontmatterze. MoÅ¼na to zrobiÄ‡ elegancko jako tablicÄ™ ze stringami, ale jest to trudne w utrzymaniu, bo Å‚atwo zapomnieÄ‡ lub popeÅ‚niÄ‡ bÅ‚Ä…d. Wystarczy string, w ktÃ³rym tagi bÄ™dÄ… oddzielone przecinkami. MoÅ¼na przy tym zrobiÄ‡ zaÅ‚oÅ¼enie, Å¼e zawsze bÄ™dziemy uÅ¼ywaÄ‡ maÅ‚ych liter.

**/src/blogposts/any-blogpost.mdx**

```js
---
tags: tag1, tag2, tag3
---
```

W dalszym przetwarzaniu tego pola trzeba pamiÄ™taÄ‡, Å¼eby przekazaÄ‡ je w zapytaniu graphql. ZaÅ‚oÅ¼enie: mamy ten sam plik gatsby-node.js, ktÃ³ry jest powyÅ¼ej.

- W gatsby-node najpierw przekazujemy Å›cieÅ¼kÄ™ do szablonu (o ktÃ³rym za chwilÄ™).
- Potem tworzymy tabelÄ™ tags ze stringÃ³w pobranych z pÃ³l tags. Klasyczna pÄ™tla for ma najwiÄ™kszÄ… wydajnoÅ›Ä‡. Dla normalizcji moÅ¼na uÅ¼yÄ‡ metody [String.prototype.toLowerCase()](https://developer.mozilla.org/pl/docs/Web/JavaScript/Reference/Global_Objects/String/toLowerCase)
- MajÄ…c juÅ¼ tabelÄ™ tags ze wszystkimi unikalnymi tagami zebranymi z requestu graphql, tworzymy Å›cieÅ¼ki dokÅ‚adnie tÄ… samÄ… metodÄ… co Å›cieÅ¼ki do wpisÃ³w blogowych. ProszÄ™ zwrÃ³ciÄ‡ uwagÄ™ na dodatkowy element "/tags" w Å›cieÅ¼ce dostÄ™pu. Zapobiega to sytuacji, kiedy slug wpisu jest identyczny z tagiem. Jest to raczej maÅ‚o prawdopodobne, ale jeÅ¼eli do tego dojdzie, nie dostaniemy siÄ™ do wpisu.

**/gatsby-node.js**

```js

//

  const tagTemplate = path.resolve("./src/templates/blogTagListTemplate.js");

//

    const tags = []
    for (let i = 0; i < posts.length; i++) {
      const arrOfTags = posts[i].frontmatter.tags.split(",")
      for (let j = 0; j < arrOfTags.length; j++) {
        if (!tags.includes(arrOfTags[j].trim())) {
          tags.push(arrOfTags[j].trim())
        }
      }
    }

//

    tags.forEach(tag => {
      createPage({
        path: "/blog/tag/" + tag,
        component: tagTemplate,
        ...tag,
        context: {
          ...tag.context,
          slug: tag,
        },
      });
    });
```

Szablon strony danego tagu.

- Pobieramy tag ze Å›cieÅ¼ki
- Na koÅ„cu pliku jest taki sam request graphql, jak na gÅ‚Ã³wnej stronie bloga. Wystarczy usunÄ…Ä‡ te pola, ktÃ³rych nie bÄ™dziemy potrzebowali.
- JuÅ¼ po inicjalizacji tagu za jego pomocÄ… filtrujemy dane graphql, przekazujÄ…c te wpisy, ktÃ³re majÄ… ten tag do nowej tablicy.
- W efekcie mamy tablicÄ™ wpisÃ³w, ktÃ³re moÅ¼na mapowaÄ‡ na listÄ™.

**/src/templates/blogTagListTemplate.js**

```js

//

const blogPage = ({ data, location }) => {

    const tag = location.pathname.slice(10)
    const filteredPosts = [...data.allMdx.nodes].filter(item => item.frontmatter.tags.includes(tag))

    return (
        <LayoutBlog>
   <article>
       <h2>Strony z tagiem {tag}</h2>
       <section>
       {filteredPosts.map(({ id, frontmatter, slug }) => (
           <li key={id}>
      <Link to={`/blog/${slug}`}>{frontmatter.title}</Link>
           </li>
       ))}
       </section>
   </article>
   <aside>
       <Link to="/blog">blog main page</Link>
   </aside>
        </LayoutBlog>
    );
};

export default blogPage

export const query = graphql`
query AllTags {
     allMdx(
      filter: { fileAbsolutePath: { glob: "**/src/blogposts/*.mdx" } }
      sort: { order: ASC, fields: frontmatter___date }
      ) {
        nodes {
   frontmatter {
       title
       tags
   }
   slug
   id
        }
    }
}
`;
```

Na koÅ„cu dodajemy listÄ™ wpisÃ³w do szablonu wpisu blogowego

**/src/templates/blogPostTemplate.js**

```js

//

const blogPage = ({ data }) => {

  const { frontmatter, id, body, slug } = data.mdx;
  const tagsArray = [...frontmatter.tags.split(",")]

//

<div className="tagsDiv">
    Tagi: <ul>
        {tagsArray.map(tag => <li key={tag}><Link to={`/blog/tag/${tag.trim()}`}>{tag.trim()}</Link></li>)}
    </ul>
</div>

//

```

W efekcie mamy sytuacjÄ™, w ktÃ³rej przy kaÅ¼dym wpisie pojawia siÄ™ lista klikalnych tagÃ³w, kaÅ¼dy kieruje do automatycznie generowanej strony z listÄ… linkÃ³w wszystkich wpisÃ³w majÄ…cych ten tag.

### OdnoÅ›niki

- Gatsby [Working with Images in Markdown Posts and Pages](https://www.gatsbyjs.com/docs/working-with-images-in-markdown/) | [Tutorial: Learn how Gatsby works](https://www.gatsbyjs.com/docs/tutorial/) | [Gatsby 5](https://www.gatsbyjs.com/gatsby-5/)
- freeCodeCamp.org [#GATSBY](https://www.freecodecamp.org/news/tag/gatsby/)
- Scott Spence ["How to Build Your Coding Blog From Scratch Using Gatsby and MDX"](https://www.freecodecamp.org/news/build-a-developer-blog-from-scratch-with-gatsby-and-mdx/)
- Josh W Comeau [tag /Gatsby](https://www.joshwcomeau.com/tutorials/gatsby/)
- Taylor Bantle ["Adding Pagination and Search to our Gatsby Blog"](https://www.dolthub.com/blog/2021-11-29-gatsby-search-and-pagination/)
- \>Dilshan Kelsen_["How To Create Future Blog Posts In Gatsby"](https://dilshankelsen.com/create-future-blog-posts-in-gatsby/) | ["Adding Search Functionality To A Gatsby Site"](https://dilshankelsen.com/adding-search-functionality-to-gatsby-site/)
- [Adding Pagination](https://www.gatsbyjs.com/docs/adding-pagination/)
- MDX [Using MDX](https://mdxjs.com/docs/using-mdx/) | ["Migrating from v1 to v2"](https://mdxjs.com/migrating/v2/)